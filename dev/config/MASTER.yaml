state_persistence:
  name: "tron_state"
  table_name: "tmp-tron-state"
  store_type: "shelve"
  buffer_size: 1
  dynamodb_region: us-west-1

eventbus_enabled: True
ssh_options:
   agent: True

nodes:
- hostname: localhost
  name: localhost
  username: batch
- hostname: localhost
  name: paasta
  username: batch

k8s_options:
    enabled: true
    kubeconfig_path: /nail/home/emanelsabban/pg/Tron/tron.conf
# Replace this with the path relative to your home dir to use
# action_runner:
#   runner_type: "subprocess"
#   remote_status_path: "pg/tron/status"
#   remote_exec_path: "pg/tron/.tox/py38/bin"

jobs:
  k8s:
    actions:
      sleep:
        annotations:
          paasta.yelp.com/routable_ip: 'false'
        cap_add: []
        cap_drop:
        - SETPCAP
        - MKNOD
        - AUDIT_WRITE
        - CHOWN
        - NET_RAW
        - DAC_OVERRIDE
        - FOWNER
        - FSETID
        - KILL
        - SETGID
        - SETUID
        - NET_BIND_SERVICE
        - SYS_CHROOT
        - SETFCAP
        command: sleep 60; echo "I'm up and running $PAASTA_DOCKER_IMAGE"
        cpus: 0.1
        disk: 1024
        docker_image: docker-paasta.yelpcorp.com:443/services-paasta-contract-monitor:paasta-a0c12fd6fbce6707947ce1fafcfdf7a7c6aaff9d
        env:
          ENABLE_PER_INSTANCE_LOGSPOUT: '1'
          PAASTA_CLUSTER: infrastage
          PAASTA_DEPLOY_GROUP: everything
          PAASTA_DOCKER_IMAGE: services-paasta-contract-monitor:paasta-a0c12fd6fbce6707947ce1fafcfdf7a7c6aaff9d
          PAASTA_GIT_SHA: a0c12fd6
          PAASTA_INSTANCE: k8s.sleep
          PAASTA_INSTANCE_TYPE: tron
          PAASTA_MONITORING_TEAM: compute_infra
          PAASTA_RESOURCE_CPUS: '0.1'
          PAASTA_RESOURCE_DISK: '1024'
          PAASTA_RESOURCE_MEM: '50'
          PAASTA_SERVICE: paasta-contract-monitor
        executor: kubernetes
        extra_volumes: []
        field_selector_env:
          PAASTA_POD_IP:
            field_path: status.podIP
        labels:
          paasta.yelp.com/cluster: infrastage
          paasta.yelp.com/instance: k8s.sleep
          paasta.yelp.com/pool: default
          paasta.yelp.com/service: paasta-contract-monitor
          yelp.com/owner: compute_infra_platform_experience
        mem: 50
        node_selectors:
          yelp.com/pool: default
        retries: 1
        secret_env:
          PAASTA_SECRET_TEST:
            key: goss
            secret_name: tron-secret-paasta-contract-monitor-goss
        secret_volumes:
        - container_path: /super-secret-data
          items:
          - key: goss
            path: secret.py
          secret_name: goss
          secret_volume_name: tron-secret-paasta-contract-monitor-goss
        service_account_name: paasta--arn-aws-iam-528741615426-role-paasta-contract-monitor
    node: paasta
    queueing: false
    monitoring:
      alert_after: 25m
      description: k8s actions failing on Tron locally
      page: false
      runbook: http://y/rb-tron
      slack_channels:
      - emans-super-cool-channel
      team: noop
      ticket: false
      tip: Check "paasta logs" and read y/rb-paasta-contract-monitor
    schedule:
      type: cron
      value: '*/1 * * * *'
    use_k8s: true
